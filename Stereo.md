# Stereo

## Gather Images to calibrate

- Code used to take samples from left/right stereo camera 
press âsâ to take a snapshot, dont forget to make `images/stereoLeft` /`images/stereoRight`  directory
    
    ```python
    import numpy as np
    import cv2
    
    # Check for left and right camera IDs
    # These values can change depending on the system
    Cam_id = 1  # Camera ID0
    
    Cam = cv2.VideoCapture(Cam_id)
    
    # Reading the mapping values for stereo image rectification
    cv_file = cv2.FileStorage("data/stereo_rectify_maps.xml", cv2.FILE_STORAGE_READ)
    Left_Stereo_Map_x = cv_file.getNode("Left_Stereo_Map_x").mat()
    Left_Stereo_Map_y = cv_file.getNode("Left_Stereo_Map_y").mat()
    Right_Stereo_Map_x = cv_file.getNode("Right_Stereo_Map_x").mat()
    Right_Stereo_Map_y = cv_file.getNode("Right_Stereo_Map_y").mat()
    cv_file.release()
    
    # Creating an object of StereoBM algorithm
    #stereo = cv2.StereoBM_create(numDisparities=16, blockSize=15)
    
    num = 0
    while True:
    
        ret,img = Cam.read()
        if not ret:
            print("Skipping frame !")
            continue
        # Capturing and storing left and right camera images
        imgL = img[:, :640//2]
        imgR = img[:,640//2:640]
        cv2.imshow("left", imgL)
        cv2.imshow("right", imgR)
        # Close window using esc key
        if cv2.waitKey(1) == 27:
            break
        elif cv2.waitKey(5) == ord('s'):  # wait for 's' key to save and exit
            cv2.imwrite('images/stereoLeft/imageL' + str(num) + '.png', imgL)
            cv2.imwrite('images/stereoRight/imageR' + str(num) + '.png', imgR)
            print("images saved!")
            num += 1
    
        # Proceed only if the frames have been captured
        if ret:
            imgR_gray = cv2.cvtColor(imgR, cv2.COLOR_BGR2GRAY)
            imgL_gray = cv2.cvtColor(imgL, cv2.COLOR_BGR2GRAY)
            # Close window using esc key
            if cv2.waitKey(1) == 27:
                break
    ```
    
    Sample of images taken to calibrate 
    
    ![imageL8.png](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/imageL8.png)
    
    [calibration images.zip](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/calibration_images.zip)
    

## Calibration

- Then use Stereo camera calibration tool in Matlab to get the stereo parameters ğ
    
    [Using the Stereo Camera Calibrator App - MATLAB & Simulink](https://www.mathworks.com/help/vision/ug/using-the-stereo-camera-calibrator-app.html)
    
    ![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled.png)
    

- Matlab calibration parameters result
    
    [st_param3.mat](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/st_param3.mat)
    
    [st_errors3.mat](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/st_errors3.mat)
    

## Test1 (Depth)

- Test code in matlab
    
    [tst.mlx](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/tst.mlx)
    
    ![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%201.png)
    

```matlab
% Load the stereoParameters object.
load('st_param3.mat')

% Visualize camera extrinsics.
showExtrinsics(stereoParams);

I1 = imread('imageR1.png');
I2 = imread('imageL1.png');

%faceDetector = vision.CascadeObjectDetector;
%face1 = faceDetector(I1)
%face2 = faceDetector(I2)
%------------------------------------
% Read the image into an array.

I1 = undistortImage(I1,stereoParams.CameraParameters1);
I2 = undistortImage(I2,stereoParams.CameraParameters2);

%face1 = [83 62 214-70 143-70]
%face2 = [154 67 285-70 146-70]

%center1 = face1(1:2) + face1(3:4)/2
%center2 = face2(1:2) + face2(3:4)/2

center1 = [133 48]
center2 = [251 52]

obj1 =  [center1 2]
obj2 = [center2 2]

point3d = triangulate(center1, center2, stereoParams)
%distanceInMeters = norm(point3d)
distanceInCm = norm(point3d)

%distanceAsString = sprintf('%0.2f mm', distanceInMeters);
I1 = insertShape(I1,'Circle',obj1,'LineWidth',5);
I2 = insertShape(I2,'Circle',obj2,'LineWidth',5);
 
imshowpair(I1, I2, 'montage');
```

Output sample

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%202.png)

- some test results
    
    ```matlab
    actual  = 53    messured  = 50.8
    actual  = 48    messured  = 47.8
    actual  = 23    messured  = 23.9
    actual  = 43    messured  = 41.8
    actual  = 13    messured  = 13.4
    actual  = 15    messured  = 15.3
    actual  = 23    messured  = 22.8
    ```
    
    [Depth Estimation From Stereo Video](https://www.mathworks.com/help/releases/R2021b/vision/ug/depth-estimation-from-stereo-video.html)
    

 

## Test2 (Depth + Length)

[stereo_param.mat](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/stereo_param.mat)

[error_est.mat](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/error_est.mat)

### Test code in matlab

[tst.mlx](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/tst%201.mlx)

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%203.png)

```matlab
load('stereo_param.mat')

% Visualize camera extrinsics.
showExtrinsics(stereoParams);

I1 = imread('badR4.png');
I2 = imread('badL4.png');

I1 = undistortImage(I1,stereoParams.CameraParameters1);
I2 = undistortImage(I2,stereoParams.CameraParameters2);

st1 = [117,110]
end1 = [158,132]

st2 = [163,116]
end2 = [203,137]

center1 = [];
center2 = [];
obj1 = [];
obj2 = [];

for row = st1(1):end1(1)
    for col = st1(2):end1(2)
        center1 = [center1;[row col]];
        obj1 = [obj1 ; [row col 1]];
    end
end

for row = st2(1):end2(1)
    for col = st2(2):end2(2)
        center2 = [center2;[row col]];
        obj2 = [obj2 ; [row col 1]];
    end
end
center1
center2

obj1
obj2

s1 = size(center1);
s2 = size(center2);

if  s1(1)> s2(1)
    min = s2(1);
end
if s1(1)< s2(1)
    min = s1(1);
end

depth_dist = [];
for i = [1:min]
    point3d = triangulate(center1(i,[1,2]), center2(i,[1,2]), stereoParams0);
    %distanceInMeters = norm(point3d)
    distanceInCm = norm(point3d)/10;
    depth_dist = [depth_dist distanceInCm];
end
plot(depth_dist)
depth = mean(depth_dist)

p1 = end1(1)-st1(1)
p2 = end2(1)-st2(1)
d = depth;
f1 = 277.5;
f2 = 277.7;
w1 = (p1*d)/f1
w2 = (p2*d)/f2

I1 = insertShape(I1,'Circle',obj1,'LineWidth',5);
I2 = insertShape(I2,'Circle',obj2,'LineWidth',5);
 
imshowpair(I1, I2, 'montage');
```

### Depth-Distance relation

F=(P * D) / W

F : focal length
P : length in pixels
D : Distance from object
W : real length

Some test results

```matlab
2  actual depth = 17.5 , messured depth = 17.7 --> actual length = 5.2 cm --> mesuured length = 5.4 cm
3  actual depth = 13.5 , messured depth = 13.3 --> actual length = 5.2 cm --> mesuured length = 5.7 cm
4  actual depth = 37.5 , messured depth = 36.6 --> actual length = 5.2 cm --> mesuured length = 5.3 cm
```

...

---

## Python

- camera calibration results
    - right
        
        ```css
        rmse: 4.099955625959618
        camera matrix:
         [[195.53013361   0.         155.10353038]
         [  0.         193.68105091 141.24894546]
         [  0.           0.           1.        ]]
        distortion coeffs: [[ 0.39189868 -1.83296797  0.01049672 -0.0395322   2.19811737]]
        Rs:
         (array([[-0.04427428],
               [ 0.29783307],
               [-0.16905621]]), array([[0.38763332],
               [0.09619236],
               [0.02511203]]), array([[ 0.10442856],
               [ 0.25028559],
               [-0.03238049]]), array([[-0.16956232],
               [ 0.66016483],
               [-0.02763544]]), array([[-0.20552027],
               [ 0.10918884],
               [-0.24421866]]), array([[-0.19676299],
               [ 0.66779783],
               [-0.06684536]]), array([[ 0.16678067],
               [-0.04040702],
               [ 0.07803042]]), array([[-0.201748  ],
               [ 0.54233309],
               [-0.19315034]]), array([[-0.73512648],
               [-0.3643397 ],
               [-0.31487716]]), array([[-0.01383878],
               [ 0.30436069],
               [-0.28628261]]), array([[ 0.09915685],
               [ 0.20838664],
               [-0.26141306]]), array([[-0.1090534 ],
               [-0.08030163],
               [-0.26262298]]), array([[-0.7035589 ],
               [ 0.37788009],
               [-0.13393235]]), array([[-0.36665418],
               [ 0.32278255],
               [ 0.18171608]]), array([[-0.04102964],
               [ 0.88246299],
               [-0.00561584]]), array([[-0.20757612],
               [ 0.32258598],
               [-0.13125377]]), array([[-0.20334453],
               [ 0.22140103],
               [-0.09270275]]), array([[-0.55215338],
               [ 0.23098886],
               [ 0.08174239]]), array([[ 0.10368312],
               [ 0.2181257 ],
               [-0.25907597]]), array([[-0.44979006],
               [-0.01379982],
               [ 0.49102718]]), array([[-0.12324453],
               [ 0.53804122],
               [-0.09428534]]), array([[-0.12811627],
               [ 0.51826686],
               [-0.10995604]]), array([[-0.84073074],
               [ 0.52965585],
               [-0.06796204]]), array([[ 0.11666053],
               [ 0.2185064 ],
               [-0.2597649 ]]), array([[-0.46539616],
               [ 0.01603223],
               [ 0.73856211]]), array([[-0.24772789],
               [ 0.12200191],
               [-0.24723971]]), array([[-0.17024973],
               [ 0.4274349 ],
               [-0.05372139]]), array([[-0.08224727],
               [ 0.12763661],
               [-0.25195231]]), array([[ 0.23122007],
               [ 0.01341667],
               [-0.02439436]]), array([[ 0.30993942],
               [ 0.50153588],
               [-0.28905992]]), array([[ 0.23558623],
               [-0.41930164],
               [-0.20379133]]), array([[-0.19986528],
               [ 0.15655006],
               [-0.2159759 ]]), array([[ 0.1032057 ],
               [-0.37944422],
               [-0.20147894]]), array([[0.39330248],
               [0.26855429],
               [0.06904196]]), array([[ 0.16488109],
               [-0.23362396],
               [-0.19141565]]), array([[-0.24877336],
               [-0.00286868],
               [-0.25363177]]), array([[-0.10907455],
               [ 0.45669641],
               [-0.06697909]]), array([[ 0.11354996],
               [-0.49300395],
               [-0.22484898]]), array([[-0.46977636],
               [-0.23711257],
               [ 0.1225932 ]]), array([[-0.32075458],
               [ 0.04736584],
               [ 0.02918628]]), array([[-0.36526966],
               [ 0.34715425],
               [ 0.17627578]]), array([[ 0.01696005],
               [ 0.26084075],
               [-0.30224984]]), array([[-0.31445001],
               [ 0.36718064],
               [ 0.188322  ]]), array([[ 0.34634397],
               [-0.63153691],
               [-0.16069219]]), array([[ 0.25642783],
               [-0.0139527 ],
               [ 0.05844913]]), array([[-0.06407997],
               [ 0.11032897],
               [-0.25599037]]), array([[-0.13960969],
               [ 0.28190464],
               [-0.15111175]]), array([[-0.13303466],
               [ 0.07624226],
               [-0.00483796]]), array([[-0.22156876],
               [-0.00443283],
               [-0.25429076]]), array([[ 0.23958735],
               [-0.44208495],
               [-0.11069231]]), array([[-0.23484114],
               [ 0.27613359],
               [-0.18762826]]), array([[ 0.10521483],
               [ 0.21006826],
               [-0.26115937]]), array([[ 0.0476535 ],
               [ 0.04174899],
               [-0.30362798]]), array([[-0.15548271],
               [ 0.1604714 ],
               [-0.10011603]]), array([[-0.34351811],
               [ 0.00111543],
               [ 0.69395767]]), array([[ 0.52674622],
               [-0.47916139],
               [-0.20976145]]), array([[-0.26167749],
               [ 0.12622702],
               [-0.02185457]]), array([[0.70633976],
               [0.13591577],
               [0.00746651]]), array([[-0.20549718],
               [-0.47100467],
               [-0.18955513]]), array([[-0.09219094],
               [ 0.25301019],
               [-0.04640558]]), array([[ 0.18367144],
               [-0.54395241],
               [-0.23077161]]), array([[-0.36526304],
               [ 0.33902413],
               [ 0.20689631]]), array([[-0.29983244],
               [ 0.18786907],
               [-0.00706963]]))
        Ts:
         (array([[-219.11652569],
               [ -90.75010328],
               [ 472.89522728]]), array([[-34.79816479],
               [-85.0486921 ],
               [687.25327032]]), array([[ 82.14040828],
               [ 81.04264104],
               [914.3240948 ]]), array([[-107.29718489],
               [-104.75812394],
               [ 519.47279426]]), array([[-238.34194971],
               [ -75.34959965],
               [ 470.40740145]]), array([[-119.96535819],
               [ -33.05078051],
               [ 552.55417612]]), array([[ -81.60195645],
               [ 136.61175445],
               [1001.91020836]]), array([[-211.10003171],
               [ -15.98711569],
               [ 795.3051906 ]]), array([[-497.67328276],
               [  80.91039864],
               [ 976.53904761]]), array([[-222.83211502],
               [ -64.97278449],
               [ 484.57129637]]), array([[-243.53222162],
               [ -67.15577412],
               [ 438.82116756]]), array([[-234.19194641],
               [ -68.04505033],
               [ 406.35796226]]), array([[-186.09409678],
               [ -29.44147103],
               [ 597.60041378]]), array([[ 37.62283337],
               [-78.03190378],
               [784.94231277]]), array([[-126.40180098],
               [-125.56562128],
               [ 559.82781639]]), array([[-234.88000561],
               [ -56.56378911],
               [ 447.73772045]]), array([[-454.49873964],
               [ -72.28430083],
               [ 828.64408418]]), array([[ 43.58554439],
               [  2.88595253],
               [822.43733226]]), array([[-242.65734831],
               [ -67.7571594 ],
               [ 439.26395674]]), array([[ 145.25021835],
               [-128.85578877],
               [ 798.60638604]]), array([[-251.13947369],
               [ -75.07211231],
               [ 530.58069965]]), array([[-251.55612295],
               [ -70.43468627],
               [ 527.13832551]]), array([[-146.97125721],
               [  10.50290769],
               [ 664.16144459]]), array([[-243.62396643],
               [ -67.0255637 ],
               [ 438.89549765]]), array([[201.91901063],
               [-74.76630518],
               [813.07638297]]), array([[-240.34855147],
               [ -75.92525655],
               [ 402.0821541 ]]), array([[-191.21084504],
               [ -94.65583535],
               [ 414.4905042 ]]), array([[-238.54395138],
               [ -76.93252794],
               [ 451.80656776]]), array([[-105.86548271],
               [ 145.34425449],
               [1123.73560499]]), array([[-228.71869951],
               [ -84.35606644],
               [ 479.34663494]]), array([[-277.59830272],
               [ -17.13773603],
               [ 651.54938888]]), array([[-244.49553604],
               [ -67.23315198],
               [ 483.10814543]]), array([[-265.16106882],
               [  18.96356228],
               [ 654.95426705]]), array([[ -18.71204986],
               [-101.17272846],
               [ 654.16496284]]), array([[-294.2720529 ],
               [  19.1170852 ],
               [ 701.74692935]]), array([[-241.65288421],
               [ -71.16565501],
               [ 450.4325091 ]]), array([[-143.09634498],
               [-102.80484833],
               [ 481.08950609]]), array([[-269.17174524],
               [ -16.7968298 ],
               [ 631.82434569]]), array([[ 61.1173888 ],
               [  2.25658058],
               [822.46586273]]), array([[ -26.64444246],
               [-229.23278184],
               [ 738.04610408]]), array([[ 35.95026138],
               [-76.06742123],
               [783.14888687]]), array([[-230.36623874],
               [ -61.98944037],
               [ 476.65741737]]), array([[ 34.19033766],
               [-77.85706075],
               [771.3871441 ]]), array([[-514.02507452],
               [  87.69526828],
               [ 889.13031764]]), array([[-84.84863856],
               [141.31324702],
               [983.064113  ]]), array([[-242.8883756 ],
               [ -75.40895843],
               [ 442.81027805]]), array([[-222.54759884],
               [ -85.62958874],
               [ 368.16032856]]), array([[-92.43472118],
               [-65.09359083],
               [479.11632586]]), array([[-242.47081057],
               [ -73.78970746],
               [ 444.68050132]]), array([[-414.04787482],
               [  20.53342954],
               [ 799.0288851 ]]), array([[-260.67235636],
               [ -65.16534574],
               [ 516.6213895 ]]), array([[-244.40718845],
               [ -67.11521969],
               [ 437.17520677]]), array([[-254.83811583],
               [ -66.47716577],
               [ 387.19646983]]), array([[-461.41228798],
               [ -76.76840294],
               [ 841.03684408]]), array([[206.14270207],
               [-83.01282536],
               [844.18596946]]), array([[-232.09188833],
               [  14.86366583],
               [ 504.25945365]]), array([[-157.08260756],
               [ -78.45781511],
               [ 350.33190796]]), array([[ -32.61028901],
               [-201.09421548],
               [ 650.09850561]]), array([[-432.39186031],
               [  18.7089963 ],
               [ 841.10666713]]), array([[-443.00398296],
               [ -62.9369963 ],
               [ 886.88060035]]), array([[-254.99345826],
               [  -8.95982471],
               [ 595.3345531 ]]), array([[ 30.95650298],
               [-82.70817765],
               [757.74532472]]), array([[-150.90227164],
               [ -81.35179472],
               [ 402.32671456]]))
        ```
        
    - left
        
        ```css
        rmse: 3.98273581374382
        camera matrix:
         [[194.19593462   0.         181.97815962]
         [  0.         192.07872476 149.63856365]
         [  0.           0.           1.        ]]
        distortion coeffs: [[-0.03416721  0.29612421  0.00402931 -0.00740002 -0.90621883]]
        Rs:
         (array([[ 0.20979484],
               [-0.82092411],
               [-0.00156729]]), array([[ 0.26273492],
               [-0.05880594],
               [-0.02925281]]), array([[-0.11526547],
               [ 0.05945353],
               [-0.08101877]]), array([[ 0.34568033],
               [ 0.39375494],
               [-0.28477221]]), array([[-0.28684714],
               [-0.60633357],
               [-0.23229969]]), array([[ 0.07878246],
               [-0.31806576],
               [-0.22513606]]), array([[ 0.08089603],
               [-0.16138883],
               [ 0.0705459 ]]), array([[0.22357039],
               [0.40117211],
               [0.11489128]]), array([[ 0.28476599],
               [ 0.26222586],
               [-0.01916727]]), array([[-0.77994247],
               [ 0.45523222],
               [-0.12459689]]), array([[ 0.01960949],
               [ 0.19711323],
               [-0.29824593]]), array([[0.75291541],
               [0.37370514],
               [0.01550142]]), array([[-0.21962218],
               [ 0.02660016],
               [-0.27212473]]), array([[-0.12322457],
               [-0.50363043],
               [-0.22818746]]), array([[ 0.02966811],
               [ 0.15808333],
               [-0.31117458]]), array([[ 0.45332267],
               [-0.62879898],
               [-0.1840949 ]]), array([[-0.19009832],
               [ 0.28168624],
               [-0.20347092]]), array([[ 0.13523876],
               [ 0.14853666],
               [-0.03574156]]), array([[0.41822021],
               [0.08549993],
               [0.03896962]]), array([[ 0.10880402],
               [ 0.11929735],
               [-0.2641444 ]]), array([[ 0.11108127],
               [ 0.1120532 ],
               [-0.2657375 ]]), array([[-0.19467314],
               [ 0.22360942],
               [-0.14891016]]), array([[-0.82470116],
               [-0.32004815],
               [-0.34607189]]), array([[ 0.07269132],
               [-0.06657172],
               [-0.3120863 ]]), array([[-0.11818755],
               [ 0.56178041],
               [-0.06258508]]), array([[-0.17538127],
               [ 0.58628847],
               [-0.08554316]]), array([[-0.10562101],
               [ 0.40683616],
               [-0.1240714 ]]), array([[-0.09841511],
               [ 0.01796553],
               [-0.09800351]]), array([[-0.17809389],
               [ 0.05374091],
               [-0.23730968]]), array([[-0.04545117],
               [ 0.01412291],
               [-0.27135682]]), array([[-0.08886226],
               [-0.18256176],
               [-0.28317874]]), array([[ 0.14954767],
               [-0.42831428],
               [-0.19801397]]), array([[-0.01492211],
               [-0.61327904],
               [-0.18476711]]), array([[-0.42733775],
               [-0.37001783],
               [ 0.1084072 ]]), array([[ 0.1262047 ],
               [-0.5182088 ],
               [-0.23073514]]), array([[-0.41589315],
               [ 0.33782931],
               [ 0.13992066]]), array([[0.49059165],
               [0.57405034],
               [0.39025096]]), array([[-0.00952238],
               [ 0.75497042],
               [-0.03305139]]), array([[ 0.1219046 ],
               [ 0.12267041],
               [-0.26378099]]), array([[-0.083106  ],
               [ 0.33579962],
               [-0.0859475 ]]), array([[ 0.69064797],
               [ 0.31751604],
               [-0.02132549]]), array([[-0.00224838],
               [-0.56063148],
               [-0.23958377]]), array([[-0.02694382],
               [ 0.1959338 ],
               [-0.18203546]]), array([[-0.12008883],
               [ 0.18473154],
               [-0.16974212]]), array([[-0.06369009],
               [ 0.03047604],
               [-0.26782042]]), array([[-0.70689193],
               [ 0.27923053],
               [-0.17915817]]), array([[ 0.10326882],
               [ 0.11136775],
               [-0.26641236]]), array([[ 0.09676909],
               [-0.0945511 ],
               [ 0.06915924]]), array([[-0.32711079],
               [ 0.45086093],
               [ 0.1749684 ]]), array([[-0.28337683],
               [ 0.10461452],
               [-0.03064464]]), array([[-0.49110677],
               [-0.09592403],
               [ 0.74189592]]), array([[-0.17800241],
               [ 0.00794445],
               [-0.26701582]]), array([[-0.14597801],
               [ 0.43205232],
               [-0.11750581]]), array([[-0.2522584 ],
               [ 0.05285155],
               [-0.04316824]]), array([[-0.15198029],
               [ 0.33432574],
               [-0.07142364]]), array([[-0.53836047],
               [-0.22063953],
               [-0.37725146]]), array([[-0.49925352],
               [-0.15654335],
               [ 0.70765752]]), array([[-0.23145743],
               [-0.10225036],
               [-0.28008765]]), array([[-0.16513887],
               [ 0.14668392],
               [-0.1975947 ]]), array([[-0.37471534],
               [ 0.45789699],
               [ 0.18350978]]), array([[-0.22747901],
               [ 0.46817754],
               [ 0.18840917]]), array([[-0.15428105],
               [ 0.00079356],
               [-0.01816037]]), array([[-0.19766128],
               [-0.1010234 ],
               [-0.27945953]]))
        Ts:
         (array([[-448.66355924],
               [ -61.63504177],
               [ 730.97368402]]), array([[-185.84911149],
               [ 144.22366234],
               [1102.69033966]]), array([[-497.73661068],
               [ -85.42785941],
               [ 767.66012453]]), array([[-228.22703082],
               [ -84.40577799],
               [ 445.66471581]]), array([[-467.19044057],
               [  14.46696427],
               [ 768.82930593]]), array([[-317.42275842],
               [  17.15914492],
               [ 661.67667717]]), array([[-144.85014188],
               [ 128.13815517],
               [ 959.27679594]]), array([[ -8.94580228],
               [-86.73386788],
               [713.32528396]]), array([[-6.84966118e+00],
               [ 1.71828153e-01],
               [ 7.77468932e+02]]), array([[-164.39255414],
               [   4.83193144],
               [ 632.58067371]]), array([[-224.59370559],
               [ -65.3644977 ],
               [ 452.68081256]]), array([[ -66.3523603 ],
               [-216.00161348],
               [ 670.61485937]]), array([[-231.45508469],
               [ -75.53342041],
               [ 370.92025438]]), array([[-302.68145175],
               [ -26.54250686],
               [ 629.36283182]]), array([[-230.76980199],
               [ -62.41635856],
               [ 445.29685479]]), array([[-234.63704212],
               [   7.59863703],
               [ 474.73514948]]), array([[-256.53909387],
               [ -20.61860706],
               [ 781.19719515]]), array([[ 31.68453698],
               [ 81.31911134],
               [920.82514677]]), array([[-60.09457421],
               [-87.20166248],
               [703.63908785]]), array([[-238.16925002],
               [ -67.86069115],
               [ 408.09185382]]), array([[-239.5339544 ],
               [ -67.26826964],
               [ 405.73508794]]), array([[-230.66124431],
               [ -56.9871711 ],
               [ 416.38415948]]), array([[-537.67947165],
               [  79.5701187 ],
               [ 869.86807447]]), array([[-244.37138683],
               [ -65.99877607],
               [ 352.99686805]]), array([[-112.48196133],
               [-106.06724757],
               [ 503.08057613]]), array([[-127.91328575],
               [ -34.75045294],
               [ 527.98063899]]), array([[-259.21971486],
               [ -71.43307892],
               [ 490.26118044]]), array([[-516.72120932],
               [ -79.0222902 ],
               [ 787.04758101]]), array([[-246.2539243 ],
               [ -67.49647259],
               [ 450.3184004 ]]), array([[-240.01221579],
               [ -75.28545715],
               [ 411.62023251]]), array([[-226.53040669],
               [ -67.56046353],
               [ 376.0233975 ]]), array([[-285.5296243 ],
               [  20.14714317],
               [ 613.10124035]]), array([[-472.48877554],
               [  23.54091668],
               [ 768.40107573]]), array([[2.45814291e+01],
               [4.26240778e-01],
               [8.04786213e+02]]), array([[-282.50832149],
               [ -12.52122904],
               [ 585.70015352]]), array([[-27.96803187],
               [-97.63711642],
               [722.48424113]]), array([[ 102.96269862],
               [-134.4684853 ],
               [ 805.85313889]]), array([[-140.90248468],
               [-126.07012574],
               [ 533.09726399]]), array([[-238.853369  ],
               [ -67.17805459],
               [ 407.78394631]]), array([[-144.50936532],
               [-104.09727295],
               [ 453.85966723]]), array([[ -63.32199215],
               [-222.60782727],
               [ 713.01195568]]), array([[-291.08814064],
               [ -20.49205969],
               [ 607.5714618 ]]), array([[-219.43852452],
               [ -91.15863139],
               [ 442.24995647]]), array([[-208.69016412],
               [ -85.08208735],
               [ 339.17045324]]), array([[-236.76185692],
               [ -77.01166263],
               [ 420.78250741]]), array([[-197.31557112],
               [ -31.0640218 ],
               [ 555.83506474]]), array([[-238.99680952],
               [ -67.35283898],
               [ 407.86441347]]), array([[-146.29475048],
               [ 133.89078027],
               [ 976.30939229]]), array([[  8.06370447],
               [-80.52108114],
               [755.13825875]]), array([[-141.12277693],
               [ -82.10961934],
               [ 378.4080747 ]]), array([[163.46644085],
               [-77.229698  ],
               [820.59033401]]), array([[-238.73590326],
               [ -75.60404767],
               [ 438.30364878]]), array([[-257.65927527],
               [ -72.37034274],
               [ 498.84538487]]), array([[-141.03303607],
               [ -78.49890302],
               [ 328.75905182]]), array([[-182.30088329],
               [ -95.15406402],
               [ 388.00059267]]), array([[-590.32503581],
               [  92.46939568],
               [ 862.5158394 ]]), array([[146.45400971],
               [-91.47770518],
               [792.80210207]]), array([[-239.09031716],
               [ -70.96475   ],
               [ 418.88207863]]), array([[-266.7493548 ],
               [ -69.91256949],
               [ 475.37344872]]), array([[ 10.38686294],
               [-79.26385756],
               [759.25000752]]), array([[  8.41709808],
               [-82.36082204],
               [754.37582396]]), array([[-94.77955365],
               [-66.77748646],
               [462.76524956]]), array([[-239.37698634],
               [ -73.5668002 ],
               [ 413.07276839]]))
        ```
        
    - all
        
        ```css
        /home/eslam/PycharmProjects/stereo/venv/bin/python /home/eslam/PycharmProjects/uw_object_detection/main.py
        rmse: 4.099955625959618
        camera matrix:
         [[195.53013361   0.         155.10353038]
         [  0.         193.68105091 141.24894546]
         [  0.           0.           1.        ]]
        distortion coeffs: [[ 0.39189868 -1.83296797  0.01049672 -0.0395322   2.19811737]]
        Rs:
         (array([[-0.04427428],
               [ 0.29783307],
               [-0.16905621]]), array([[0.38763332],
               [0.09619236],
               [0.02511203]]), array([[ 0.10442856],
               [ 0.25028559],
               [-0.03238049]]), array([[-0.16956232],
               [ 0.66016483],
               [-0.02763544]]), array([[-0.20552027],
               [ 0.10918884],
               [-0.24421866]]), array([[-0.19676299],
               [ 0.66779783],
               [-0.06684536]]), array([[ 0.16678067],
               [-0.04040702],
               [ 0.07803042]]), array([[-0.201748  ],
               [ 0.54233309],
               [-0.19315034]]), array([[-0.73512648],
               [-0.3643397 ],
               [-0.31487716]]), array([[-0.01383878],
               [ 0.30436069],
               [-0.28628261]]), array([[ 0.09915685],
               [ 0.20838664],
               [-0.26141306]]), array([[-0.1090534 ],
               [-0.08030163],
               [-0.26262298]]), array([[-0.7035589 ],
               [ 0.37788009],
               [-0.13393235]]), array([[-0.36665418],
               [ 0.32278255],
               [ 0.18171608]]), array([[-0.04102964],
               [ 0.88246299],
               [-0.00561584]]), array([[-0.20757612],
               [ 0.32258598],
               [-0.13125377]]), array([[-0.20334453],
               [ 0.22140103],
               [-0.09270275]]), array([[-0.55215338],
               [ 0.23098886],
               [ 0.08174239]]), array([[ 0.10368312],
               [ 0.2181257 ],
               [-0.25907597]]), array([[-0.44979006],
               [-0.01379982],
               [ 0.49102718]]), array([[-0.12324453],
               [ 0.53804122],
               [-0.09428534]]), array([[-0.12811627],
               [ 0.51826686],
               [-0.10995604]]), array([[-0.84073074],
               [ 0.52965585],
               [-0.06796204]]), array([[ 0.11666053],
               [ 0.2185064 ],
               [-0.2597649 ]]), array([[-0.46539616],
               [ 0.01603223],
               [ 0.73856211]]), array([[-0.24772789],
               [ 0.12200191],
               [-0.24723971]]), array([[-0.17024973],
               [ 0.4274349 ],
               [-0.05372139]]), array([[-0.08224727],
               [ 0.12763661],
               [-0.25195231]]), array([[ 0.23122007],
               [ 0.01341667],
               [-0.02439436]]), array([[ 0.30993942],
               [ 0.50153588],
               [-0.28905992]]), array([[ 0.23558623],
               [-0.41930164],
               [-0.20379133]]), array([[-0.19986528],
               [ 0.15655006],
               [-0.2159759 ]]), array([[ 0.1032057 ],
               [-0.37944422],
               [-0.20147894]]), array([[0.39330248],
               [0.26855429],
               [0.06904196]]), array([[ 0.16488109],
               [-0.23362396],
               [-0.19141565]]), array([[-0.24877336],
               [-0.00286868],
               [-0.25363177]]), array([[-0.10907455],
               [ 0.45669641],
               [-0.06697909]]), array([[ 0.11354996],
               [-0.49300395],
               [-0.22484898]]), array([[-0.46977636],
               [-0.23711257],
               [ 0.1225932 ]]), array([[-0.32075458],
               [ 0.04736584],
               [ 0.02918628]]), array([[-0.36526966],
               [ 0.34715425],
               [ 0.17627578]]), array([[ 0.01696005],
               [ 0.26084075],
               [-0.30224984]]), array([[-0.31445001],
               [ 0.36718064],
               [ 0.188322  ]]), array([[ 0.34634397],
               [-0.63153691],
               [-0.16069219]]), array([[ 0.25642783],
               [-0.0139527 ],
               [ 0.05844913]]), array([[-0.06407997],
               [ 0.11032897],
               [-0.25599037]]), array([[-0.13960969],
               [ 0.28190464],
               [-0.15111175]]), array([[-0.13303466],
               [ 0.07624226],
               [-0.00483796]]), array([[-0.22156876],
               [-0.00443283],
               [-0.25429076]]), array([[ 0.23958735],
               [-0.44208495],
               [-0.11069231]]), array([[-0.23484114],
               [ 0.27613359],
               [-0.18762826]]), array([[ 0.10521483],
               [ 0.21006826],
               [-0.26115937]]), array([[ 0.0476535 ],
               [ 0.04174899],
               [-0.30362798]]), array([[-0.15548271],
               [ 0.1604714 ],
               [-0.10011603]]), array([[-0.34351811],
               [ 0.00111543],
               [ 0.69395767]]), array([[ 0.52674622],
               [-0.47916139],
               [-0.20976145]]), array([[-0.26167749],
               [ 0.12622702],
               [-0.02185457]]), array([[0.70633976],
               [0.13591577],
               [0.00746651]]), array([[-0.20549718],
               [-0.47100467],
               [-0.18955513]]), array([[-0.09219094],
               [ 0.25301019],
               [-0.04640558]]), array([[ 0.18367144],
               [-0.54395241],
               [-0.23077161]]), array([[-0.36526304],
               [ 0.33902413],
               [ 0.20689631]]), array([[-0.29983244],
               [ 0.18786907],
               [-0.00706963]]))
        Ts:
         (array([[-219.11652569],
               [ -90.75010328],
               [ 472.89522728]]), array([[-34.79816479],
               [-85.0486921 ],
               [687.25327032]]), array([[ 82.14040828],
               [ 81.04264104],
               [914.3240948 ]]), array([[-107.29718489],
               [-104.75812394],
               [ 519.47279426]]), array([[-238.34194971],
               [ -75.34959965],
               [ 470.40740145]]), array([[-119.96535819],
               [ -33.05078051],
               [ 552.55417612]]), array([[ -81.60195645],
               [ 136.61175445],
               [1001.91020836]]), array([[-211.10003171],
               [ -15.98711569],
               [ 795.3051906 ]]), array([[-497.67328276],
               [  80.91039864],
               [ 976.53904761]]), array([[-222.83211502],
               [ -64.97278449],
               [ 484.57129637]]), array([[-243.53222162],
               [ -67.15577412],
               [ 438.82116756]]), array([[-234.19194641],
               [ -68.04505033],
               [ 406.35796226]]), array([[-186.09409678],
               [ -29.44147103],
               [ 597.60041378]]), array([[ 37.62283337],
               [-78.03190378],
               [784.94231277]]), array([[-126.40180098],
               [-125.56562128],
               [ 559.82781639]]), array([[-234.88000561],
               [ -56.56378911],
               [ 447.73772045]]), array([[-454.49873964],
               [ -72.28430083],
               [ 828.64408418]]), array([[ 43.58554439],
               [  2.88595253],
               [822.43733226]]), array([[-242.65734831],
               [ -67.7571594 ],
               [ 439.26395674]]), array([[ 145.25021835],
               [-128.85578877],
               [ 798.60638604]]), array([[-251.13947369],
               [ -75.07211231],
               [ 530.58069965]]), array([[-251.55612295],
               [ -70.43468627],
               [ 527.13832551]]), array([[-146.97125721],
               [  10.50290769],
               [ 664.16144459]]), array([[-243.62396643],
               [ -67.0255637 ],
               [ 438.89549765]]), array([[201.91901063],
               [-74.76630518],
               [813.07638297]]), array([[-240.34855147],
               [ -75.92525655],
               [ 402.0821541 ]]), array([[-191.21084504],
               [ -94.65583535],
               [ 414.4905042 ]]), array([[-238.54395138],
               [ -76.93252794],
               [ 451.80656776]]), array([[-105.86548271],
               [ 145.34425449],
               [1123.73560499]]), array([[-228.71869951],
               [ -84.35606644],
               [ 479.34663494]]), array([[-277.59830272],
               [ -17.13773603],
               [ 651.54938888]]), array([[-244.49553604],
               [ -67.23315198],
               [ 483.10814543]]), array([[-265.16106882],
               [  18.96356228],
               [ 654.95426705]]), array([[ -18.71204986],
               [-101.17272846],
               [ 654.16496284]]), array([[-294.2720529 ],
               [  19.1170852 ],
               [ 701.74692935]]), array([[-241.65288421],
               [ -71.16565501],
               [ 450.4325091 ]]), array([[-143.09634498],
               [-102.80484833],
               [ 481.08950609]]), array([[-269.17174524],
               [ -16.7968298 ],
               [ 631.82434569]]), array([[ 61.1173888 ],
               [  2.25658058],
               [822.46586273]]), array([[ -26.64444246],
               [-229.23278184],
               [ 738.04610408]]), array([[ 35.95026138],
               [-76.06742123],
               [783.14888687]]), array([[-230.36623874],
               [ -61.98944037],
               [ 476.65741737]]), array([[ 34.19033766],
               [-77.85706075],
               [771.3871441 ]]), array([[-514.02507452],
               [  87.69526828],
               [ 889.13031764]]), array([[-84.84863856],
               [141.31324702],
               [983.064113  ]]), array([[-242.8883756 ],
               [ -75.40895843],
               [ 442.81027805]]), array([[-222.54759884],
               [ -85.62958874],
               [ 368.16032856]]), array([[-92.43472118],
               [-65.09359083],
               [479.11632586]]), array([[-242.47081057],
               [ -73.78970746],
               [ 444.68050132]]), array([[-414.04787482],
               [  20.53342954],
               [ 799.0288851 ]]), array([[-260.67235636],
               [ -65.16534574],
               [ 516.6213895 ]]), array([[-244.40718845],
               [ -67.11521969],
               [ 437.17520677]]), array([[-254.83811583],
               [ -66.47716577],
               [ 387.19646983]]), array([[-461.41228798],
               [ -76.76840294],
               [ 841.03684408]]), array([[206.14270207],
               [-83.01282536],
               [844.18596946]]), array([[-232.09188833],
               [  14.86366583],
               [ 504.25945365]]), array([[-157.08260756],
               [ -78.45781511],
               [ 350.33190796]]), array([[ -32.61028901],
               [-201.09421548],
               [ 650.09850561]]), array([[-432.39186031],
               [  18.7089963 ],
               [ 841.10666713]]), array([[-443.00398296],
               [ -62.9369963 ],
               [ 886.88060035]]), array([[-254.99345826],
               [  -8.95982471],
               [ 595.3345531 ]]), array([[ 30.95650298],
               [-82.70817765],
               [757.74532472]]), array([[-150.90227164],
               [ -81.35179472],
               [ 402.32671456]]))
        -------------------------------------------------------------------------
        rmse: 3.98273581374382
        camera matrix:
         [[194.19593462   0.         181.97815962]
         [  0.         192.07872476 149.63856365]
         [  0.           0.           1.        ]]
        distortion coeffs: [[-0.03416721  0.29612421  0.00402931 -0.00740002 -0.90621883]]
        Rs:
         (array([[ 0.20979484],
               [-0.82092411],
               [-0.00156729]]), array([[ 0.26273492],
               [-0.05880594],
               [-0.02925281]]), array([[-0.11526547],
               [ 0.05945353],
               [-0.08101877]]), array([[ 0.34568033],
               [ 0.39375494],
               [-0.28477221]]), array([[-0.28684714],
               [-0.60633357],
               [-0.23229969]]), array([[ 0.07878246],
               [-0.31806576],
               [-0.22513606]]), array([[ 0.08089603],
               [-0.16138883],
               [ 0.0705459 ]]), array([[0.22357039],
               [0.40117211],
               [0.11489128]]), array([[ 0.28476599],
               [ 0.26222586],
               [-0.01916727]]), array([[-0.77994247],
               [ 0.45523222],
               [-0.12459689]]), array([[ 0.01960949],
               [ 0.19711323],
               [-0.29824593]]), array([[0.75291541],
               [0.37370514],
               [0.01550142]]), array([[-0.21962218],
               [ 0.02660016],
               [-0.27212473]]), array([[-0.12322457],
               [-0.50363043],
               [-0.22818746]]), array([[ 0.02966811],
               [ 0.15808333],
               [-0.31117458]]), array([[ 0.45332267],
               [-0.62879898],
               [-0.1840949 ]]), array([[-0.19009832],
               [ 0.28168624],
               [-0.20347092]]), array([[ 0.13523876],
               [ 0.14853666],
               [-0.03574156]]), array([[0.41822021],
               [0.08549993],
               [0.03896962]]), array([[ 0.10880402],
               [ 0.11929735],
               [-0.2641444 ]]), array([[ 0.11108127],
               [ 0.1120532 ],
               [-0.2657375 ]]), array([[-0.19467314],
               [ 0.22360942],
               [-0.14891016]]), array([[-0.82470116],
               [-0.32004815],
               [-0.34607189]]), array([[ 0.07269132],
               [-0.06657172],
               [-0.3120863 ]]), array([[-0.11818755],
               [ 0.56178041],
               [-0.06258508]]), array([[-0.17538127],
               [ 0.58628847],
               [-0.08554316]]), array([[-0.10562101],
               [ 0.40683616],
               [-0.1240714 ]]), array([[-0.09841511],
               [ 0.01796553],
               [-0.09800351]]), array([[-0.17809389],
               [ 0.05374091],
               [-0.23730968]]), array([[-0.04545117],
               [ 0.01412291],
               [-0.27135682]]), array([[-0.08886226],
               [-0.18256176],
               [-0.28317874]]), array([[ 0.14954767],
               [-0.42831428],
               [-0.19801397]]), array([[-0.01492211],
               [-0.61327904],
               [-0.18476711]]), array([[-0.42733775],
               [-0.37001783],
               [ 0.1084072 ]]), array([[ 0.1262047 ],
               [-0.5182088 ],
               [-0.23073514]]), array([[-0.41589315],
               [ 0.33782931],
               [ 0.13992066]]), array([[0.49059165],
               [0.57405034],
               [0.39025096]]), array([[-0.00952238],
               [ 0.75497042],
               [-0.03305139]]), array([[ 0.1219046 ],
               [ 0.12267041],
               [-0.26378099]]), array([[-0.083106  ],
               [ 0.33579962],
               [-0.0859475 ]]), array([[ 0.69064797],
               [ 0.31751604],
               [-0.02132549]]), array([[-0.00224838],
               [-0.56063148],
               [-0.23958377]]), array([[-0.02694382],
               [ 0.1959338 ],
               [-0.18203546]]), array([[-0.12008883],
               [ 0.18473154],
               [-0.16974212]]), array([[-0.06369009],
               [ 0.03047604],
               [-0.26782042]]), array([[-0.70689193],
               [ 0.27923053],
               [-0.17915817]]), array([[ 0.10326882],
               [ 0.11136775],
               [-0.26641236]]), array([[ 0.09676909],
               [-0.0945511 ],
               [ 0.06915924]]), array([[-0.32711079],
               [ 0.45086093],
               [ 0.1749684 ]]), array([[-0.28337683],
               [ 0.10461452],
               [-0.03064464]]), array([[-0.49110677],
               [-0.09592403],
               [ 0.74189592]]), array([[-0.17800241],
               [ 0.00794445],
               [-0.26701582]]), array([[-0.14597801],
               [ 0.43205232],
               [-0.11750581]]), array([[-0.2522584 ],
               [ 0.05285155],
               [-0.04316824]]), array([[-0.15198029],
               [ 0.33432574],
               [-0.07142364]]), array([[-0.53836047],
               [-0.22063953],
               [-0.37725146]]), array([[-0.49925352],
               [-0.15654335],
               [ 0.70765752]]), array([[-0.23145743],
               [-0.10225036],
               [-0.28008765]]), array([[-0.16513887],
               [ 0.14668392],
               [-0.1975947 ]]), array([[-0.37471534],
               [ 0.45789699],
               [ 0.18350978]]), array([[-0.22747901],
               [ 0.46817754],
               [ 0.18840917]]), array([[-0.15428105],
               [ 0.00079356],
               [-0.01816037]]), array([[-0.19766128],
               [-0.1010234 ],
               [-0.27945953]]))
        Ts:
         (array([[-448.66355924],
               [ -61.63504177],
               [ 730.97368402]]), array([[-185.84911149],
               [ 144.22366234],
               [1102.69033966]]), array([[-497.73661068],
               [ -85.42785941],
               [ 767.66012453]]), array([[-228.22703082],
               [ -84.40577799],
               [ 445.66471581]]), array([[-467.19044057],
               [  14.46696427],
               [ 768.82930593]]), array([[-317.42275842],
               [  17.15914492],
               [ 661.67667717]]), array([[-144.85014188],
               [ 128.13815517],
               [ 959.27679594]]), array([[ -8.94580228],
               [-86.73386788],
               [713.32528396]]), array([[-6.84966118e+00],
               [ 1.71828153e-01],
               [ 7.77468932e+02]]), array([[-164.39255414],
               [   4.83193144],
               [ 632.58067371]]), array([[-224.59370559],
               [ -65.3644977 ],
               [ 452.68081256]]), array([[ -66.3523603 ],
               [-216.00161348],
               [ 670.61485937]]), array([[-231.45508469],
               [ -75.53342041],
               [ 370.92025438]]), array([[-302.68145175],
               [ -26.54250686],
               [ 629.36283182]]), array([[-230.76980199],
               [ -62.41635856],
               [ 445.29685479]]), array([[-234.63704212],
               [   7.59863703],
               [ 474.73514948]]), array([[-256.53909387],
               [ -20.61860706],
               [ 781.19719515]]), array([[ 31.68453698],
               [ 81.31911134],
               [920.82514677]]), array([[-60.09457421],
               [-87.20166248],
               [703.63908785]]), array([[-238.16925002],
               [ -67.86069115],
               [ 408.09185382]]), array([[-239.5339544 ],
               [ -67.26826964],
               [ 405.73508794]]), array([[-230.66124431],
               [ -56.9871711 ],
               [ 416.38415948]]), array([[-537.67947165],
               [  79.5701187 ],
               [ 869.86807447]]), array([[-244.37138683],
               [ -65.99877607],
               [ 352.99686805]]), array([[-112.48196133],
               [-106.06724757],
               [ 503.08057613]]), array([[-127.91328575],
               [ -34.75045294],
               [ 527.98063899]]), array([[-259.21971486],
               [ -71.43307892],
               [ 490.26118044]]), array([[-516.72120932],
               [ -79.0222902 ],
               [ 787.04758101]]), array([[-246.2539243 ],
               [ -67.49647259],
               [ 450.3184004 ]]), array([[-240.01221579],
               [ -75.28545715],
               [ 411.62023251]]), array([[-226.53040669],
               [ -67.56046353],
               [ 376.0233975 ]]), array([[-285.5296243 ],
               [  20.14714317],
               [ 613.10124035]]), array([[-472.48877554],
               [  23.54091668],
               [ 768.40107573]]), array([[2.45814291e+01],
               [4.26240778e-01],
               [8.04786213e+02]]), array([[-282.50832149],
               [ -12.52122904],
               [ 585.70015352]]), array([[-27.96803187],
               [-97.63711642],
               [722.48424113]]), array([[ 102.96269862],
               [-134.4684853 ],
               [ 805.85313889]]), array([[-140.90248468],
               [-126.07012574],
               [ 533.09726399]]), array([[-238.853369  ],
               [ -67.17805459],
               [ 407.78394631]]), array([[-144.50936532],
               [-104.09727295],
               [ 453.85966723]]), array([[ -63.32199215],
               [-222.60782727],
               [ 713.01195568]]), array([[-291.08814064],
               [ -20.49205969],
               [ 607.5714618 ]]), array([[-219.43852452],
               [ -91.15863139],
               [ 442.24995647]]), array([[-208.69016412],
               [ -85.08208735],
               [ 339.17045324]]), array([[-236.76185692],
               [ -77.01166263],
               [ 420.78250741]]), array([[-197.31557112],
               [ -31.0640218 ],
               [ 555.83506474]]), array([[-238.99680952],
               [ -67.35283898],
               [ 407.86441347]]), array([[-146.29475048],
               [ 133.89078027],
               [ 976.30939229]]), array([[  8.06370447],
               [-80.52108114],
               [755.13825875]]), array([[-141.12277693],
               [ -82.10961934],
               [ 378.4080747 ]]), array([[163.46644085],
               [-77.229698  ],
               [820.59033401]]), array([[-238.73590326],
               [ -75.60404767],
               [ 438.30364878]]), array([[-257.65927527],
               [ -72.37034274],
               [ 498.84538487]]), array([[-141.03303607],
               [ -78.49890302],
               [ 328.75905182]]), array([[-182.30088329],
               [ -95.15406402],
               [ 388.00059267]]), array([[-590.32503581],
               [  92.46939568],
               [ 862.5158394 ]]), array([[146.45400971],
               [-91.47770518],
               [792.80210207]]), array([[-239.09031716],
               [ -70.96475   ],
               [ 418.88207863]]), array([[-266.7493548 ],
               [ -69.91256949],
               [ 475.37344872]]), array([[ 10.38686294],
               [-79.26385756],
               [759.25000752]]), array([[  8.41709808],
               [-82.36082204],
               [754.37582396]]), array([[-94.77955365],
               [-66.77748646],
               [462.76524956]]), array([[-239.37698634],
               [ -73.5668002 ],
               [ 413.07276839]]))
        -------------------------------------------------------------------------
        ret 4.17845424720284
        CM1 [[195.53013361   0.         155.10353038]
         [  0.         193.68105091 141.24894546]
         [  0.           0.           1.        ]]
        dist1 [[ 0.39189868 -1.83296797  0.01049672 -0.0395322   2.19811737]]
        CM2 [[194.19593462   0.         181.97815962]
         [  0.         192.07872476 149.63856365]
         [  0.           0.           1.        ]]
        dist2 [[-0.03416721  0.29612421  0.00402931 -0.00740002 -0.90621883]]
        R [[ 9.93002353e-01  4.13628973e-03 -1.18022106e-01]
         [-4.14515502e-03  9.99991394e-01  1.70353201e-04]
         [ 1.18021795e-01  3.20058796e-04  9.93010953e-01]]
        T [[55.72920493]
         [-2.28729376]
         [-4.04597934]]
        E [[-2.86721727e-01  4.04521245e+00 -2.27061851e+00]
         [-1.05949278e+01 -3.45719650e-02 -5.48621959e+01]
         [ 2.04028189e+00  5.57381862e+01 -2.60457578e-01]]
        F [[ 4.50638556e-06 -6.41853098e-05  1.53450650e-02]
         [ 1.68355231e-04  5.54599204e-07  1.44266430e-01]
         [-3.22397738e-02 -1.60148919e-01  1.00000000e+00]]
        ----------------------------------------------------------------
        
        Process finished with exit code 0
        ```
        
    - python code
        
        ```python
        import cv2 as cv
        import numpy as np
        import os
        from scipy import linalg
        
        def calibrate_camera(images_folder):
            images_names = os.listdir(images_folder)
            images = []
            for imname in images_names:
                im = cv.imread(images_folder + '/' + imname, 1)
                images.append(im)
        
            # criteria used by checkerboard pattern detector.
            # Change this if the code can't find the checkerboard
            criteria = (cv.TERM_CRITERIA_EPS + cv.TERM_CRITERIA_MAX_ITER, 30, 0.001)
        
            rows = 9  # number of checkerboard rows.
            columns = 6  # number of checkerboard columns.
            world_scaling = 35  # change this to the real world square size. Or not.
        
            # coordinates of squares in the checkerboard world space
            objp = np.zeros((rows * columns, 3), np.float32)
            objp[:, :2] = np.mgrid[0:rows, 0:columns].T.reshape(-1, 2)
            objp = world_scaling * objp
        
            # frame dimensions. Frames should be the same size.
            width = images[0].shape[1]
            height = images[0].shape[0]
        
            # Pixel coordinates of checkerboards
            imgpoints = []  # 2d points in image plane.
        
            # coordinates of the checkerboard in checkerboard world space.
            objpoints = []  # 3d point in real world space
        
            for frame in images:
                gray = cv.cvtColor(frame, cv.COLOR_BGR2GRAY)
        
                # find the checkerboard
                ret, corners = cv.findChessboardCorners(gray, (rows, columns), None)
        
                if ret == True:
                    # Convolution size used to improve corner detection. Don't make this too large.
                    conv_size = (11, 11)
        
                    # opencv can attempt to improve the checkerboard coordinates
                    corners = cv.cornerSubPix(gray, corners, conv_size, (-1, -1), criteria)
                    cv.drawChessboardCorners(frame, (rows, columns), corners, ret)
                    cv.imshow('img', frame)
                    #k = cv.waitKey(500)
        
                    objpoints.append(objp)
                    imgpoints.append(corners)
        
            ret, mtx, dist, rvecs, tvecs = cv.calibrateCamera(objpoints, imgpoints, (width, height), None, None)
            print('rmse:', ret)
            print('camera matrix:\n', mtx)
            print('distortion coeffs:', dist)
            print('Rs:\n', rvecs)
            print('Ts:\n', tvecs)
            print('-------------------------------------------------------------------------')
            return mtx, dist
        
        def stereo_calibrate(mtx1, dist1, mtx2, dist2, frames_folder):
            # read the synched frames
            c1_images_names = os.listdir(frames_folder+'/'+'stereoRight')
            c2_images_names = os.listdir(frames_folder+'/'+'stereoLeft')
            c1_images_names = sorted(c1_images_names)
            c2_images_names = sorted(c2_images_names)
        
            c1_images = []
            c2_images = []
            for im1, im2 in zip(c1_images_names, c2_images_names):
                _im = cv.imread(frames_folder+'/'+'stereoRight'+'/'+im1, 1)
                c1_images.append(_im)
        
                _im = cv.imread(frames_folder+'/'+'stereoLeft'+'/'+im2, 1)
                c2_images.append(_im)
        
            # change this if stereo calibration not good.
            criteria = (cv.TERM_CRITERIA_EPS + cv.TERM_CRITERIA_MAX_ITER, 100, 0.0001)
        
            rows = 9  # number of checkerboard rows.
            columns = 6  # number of checkerboard columns.
            world_scaling = 35  # change this to the real world square size. Or not.
        
            # coordinates of squares in the checkerboard world space
            objp = np.zeros((rows * columns, 3), np.float32)
            objp[:, :2] = np.mgrid[0:rows, 0:columns].T.reshape(-1, 2)
            objp = world_scaling * objp
        
            # frame dimensions. Frames should be the same size.
            width = c1_images[0].shape[1]
            height = c1_images[0].shape[0]
        
            # Pixel coordinates of checkerboards
            imgpoints_left = []  # 2d points in image plane.
            imgpoints_right = []
        
            # coordinates of the checkerboard in checkerboard world space.
            objpoints = []  # 3d point in real world space
        
            for frame1, frame2 in zip(c1_images, c2_images):
                gray1 = cv.cvtColor(frame1, cv.COLOR_BGR2GRAY)
                gray2 = cv.cvtColor(frame2, cv.COLOR_BGR2GRAY)
                c_ret1, corners1 = cv.findChessboardCorners(gray1, (rows, columns), None)
                c_ret2, corners2 = cv.findChessboardCorners(gray2, (rows, columns), None)
        
                if c_ret1 == True and c_ret2 == True:
                    corners1 = cv.cornerSubPix(gray1, corners1, (11, 11), (-1, -1), criteria)
                    corners2 = cv.cornerSubPix(gray2, corners2, (11, 11), (-1, -1), criteria)
        
                    cv.drawChessboardCorners(frame1, (rows, columns), corners1, c_ret1)
                    cv.imshow('img', frame1)
        
                    cv.drawChessboardCorners(frame2, (rows, columns), corners2, c_ret2)
                    cv.imshow('img2', frame2)
                    #k = cv.waitKey(500)
        
                    objpoints.append(objp)
                    imgpoints_left.append(corners1)
                    imgpoints_right.append(corners2)
        
            stereocalibration_flags = cv.CALIB_FIX_INTRINSIC
            ret, CM1, dist1, CM2, dist2, R, T, E, F = cv.stereoCalibrate(objpoints, imgpoints_left, imgpoints_right, mtx1,
                                                                         dist1,
                                                                         mtx2, dist2, (width, height), criteria=criteria,
                                                                         flags=stereocalibration_flags)
        
            print('ret',ret)
            print('CM1',CM1)
            print('dist1',dist1)
            print('CM2',CM2)
            print('dist2',dist2)
            print('R',R)
            print('T',T)
            print('E',E)
            print('F',F)
            print("----------------------------------------------------------------")
            return R, T
        
        def DLT(P1, P2, point1, point2):
            A = [point1[1] * P1[2, :] - P1[1, :],
                 P1[0, :] - point1[0] * P1[2, :],
                 point2[1] * P2[2, :] - P2[1, :],
                 P2[0, :] - point2[0] * P2[2, :]
                 ]
            A = np.array(A).reshape((4, 4))
            # print('A: ')
            # print(A)
        
            B = A.transpose() @ A
            U, s, Vh = linalg.svd(B, full_matrices=False)
        
            print('Triangulated point: ')
            return Vh[3, 0:3] / Vh[3, 3]
        
        mtx1, dist1 = calibrate_camera("images/stereoRight")
        mtx2, dist2 = calibrate_camera("images/stereoLeft")
        R, T = stereo_calibrate(mtx1, dist1, mtx2, dist2, 'images')
        
        # RT matrix for C1 is identity.
        RT1 = np.concatenate([np.eye(3), [[0], [0], [0]]], axis=-1)
        P1 = mtx1 @ RT1  # projection matrix for C1
        
        # RT matrix for C2 is the R and T obtained from stereo calibration.
        RT2 = np.concatenate([R, T], axis=-1)
        P2 = mtx2 @ RT2  # projection matrix for C2
        
        frame1 = cv.imread('images/imageR00.png')
        frame2 = cv.imread('images/imageL00.png')
        """cv.imshow('f1',frame1)
        cv.imshow('f2',frame2)
        cv.waitKey(0)"""
        
        stpoint1 = [85,72]
        endpoint1 = [160,109]
        stpoint2 = [173,80]
        endpoint2 = [247,116]
        
        center1 = []
        center2 = []
        
        for row in range(stpoint1[0],endpoint1[0]):
            for col in range(stpoint1[1],endpoint1[1]):
                center1.append([row,col])
        
        for row in range(stpoint2[0],endpoint2[0]):
            for col in range(stpoint2[1],endpoint2[1]):
                center2.append([row,col])
        
        if  len(center1)> len(center2):
            min = len(center2)
        
        if len(center1)< len(center2):
            min = len(center1)
        
        depth_dist = []
        for i in range(1,min):
            point3d = DLT(P1, P2, center1[i], center2[i])
            depth_dist.append(point3d[2])
        
        #p3d = DLT(P1, P2, point1, point2)
        print(depth_dist)
        ```
        
    
    [images.zip](Stereo%20c105c50f337c47fab74338f8ea94de41/images.zip)
    
- What I have done is to export Intrinsics, Distortion coefficients, R and T to a file and write a C++ OpenCV programme to read them in. Then you can use the OpenCV function "stereoRectify" to get the R1, R2, P1, P2 and Q you want.

[Asses calibration result using OpenCV vs Matlab](https://stackoverflow.com/questions/64188044/asses-calibration-result-using-opencv-vs-matlab)

[Convert between MATLAB stereoParameters and OpenCV stereoRectify stereo calibration](https://stackoverflow.com/questions/46651936/convert-between-matlab-stereoparameters-and-opencv-stereorectify-stereo-calibrat/50925828#50925828)

## Matlap python mapping

```matlab
cameraMatrix1 =  stereoParameters.CameraParameters1.IntrinsicMatrix'
[277.568209281413,0,175.994911474612;
0,275.854471050798,126.303097063272;
0,0,1]

cameraMatrix2 = stereoParameters.CameraParameters2.IntrinsicMatrix'
[277.715050885340,0,178.386954557862;
0,276.046208656089,133.035513725994;
0,0,1]

%no RadialDistortion(3) only 1:2
distCoeffs1 = [stereoParameters.CameraParameters1.RadialDistortion(1:2), stereoParameters.CameraParameters1.TangentialDistortion, stereoParameters.CameraParameters1.RadialDistortion(3)]
[[0.106470018522182,-0.191653327533418],[0,0]] 

distCoeffs2 = [stereoParameters.CameraParameters2.RadialDistortion(1:2), stereoParameters.CameraParameters2.TangentialDistortion, stereoParameters.CameraParameters2.RadialDistortion(3)]
[[0.0804085091338224,-0.126266161749049],[0,0]]

R = stereoParameters.RotationOfCamera2'
[0.999952002568791,0.00795459232996310,-0.00571987932823699;
 -0.00795254560327413,0.999968305623573,0.000380482258625782;
 0.00572272462148460,-0.000334976395251666,0.999983568971871]

T = stereoParameters.TranslationOfCamera2'
[60.2236749452017;
0.229221148029915;
0.548228768631346]

%%%%%%%%%%%%%%%%%%%%%%%%%%%
cameraMatrix1 =np.array([[277.568209281413,0,175.994911474612],
                          [0,275.854471050798,126.303097063272],
                          [0,0,1]])

cameraMatrix2 = np.array([[277.715050885340,0,178.386954557862],
                           [0,276.046208656089,133.035513725994],
                           [0,0,1]])

#no RadialDistortion(3) only 1:2
distCoeffs1 = [0.106470018522182,-0.191653327533418,0,0] 

distCoeffs2 = [0.0804085091338224,-0.126266161749049,0,0]

R = np.array([[0.999952002568791,0.00795459232996310,-0.00571987932823699],
             [-0.00795254560327413,0.999968305623573,0.000380482258625782],
             [0.00572272462148460,-0.000334976395251666,0.999983568971871]])

T =np.array([[60.2236749452017],
             [0.229221148029915],
             [0.548228768631346]])

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

import cv2
import numpy as np

cameraMatrix1 =np.array([[277.568209281413,0,175.994911474612],
                          [0,275.854471050798,126.303097063272],
                          [0,0,1]])

cameraMatrix2 = np.array([[277.715050885340,0,178.386954557862],
                           [0,276.046208656089,133.035513725994],
                           [0,0,1]])

#no RadialDistortion(3) only 1:2
distCoeffs1 = np.array([[0.106470018522182,-0.191653327533418,0,0]])

distCoeffs2 = np.array([[0.0804085091338224,-0.126266161749049,0,0]])

R = np.array([[0.999952002568791,0.00795459232996310,-0.00571987932823699],
             [-0.00795254560327413,0.999968305623573,0.000380482258625782],
             [0.00572272462148460,-0.000334976395251666,0.999983568971871]])

T =np.array([[60.2236749452017],
             [0.229221148029915],
             [0.548228768631346]])

imageSize = np.array([240,320])
(R1, R2, P1, P2, Q, leftROI, rightROI) = cv2.stereoRectify(cameraMatrix1, distCoeffs1, cameraMatrix2, distCoeffs2, imageSize, R, T, None, None, None, None, None, cv2.CALIB_ZERO_DISPARITY, 0)
print('R1 =',R1)
print('--------------------------')

print('R2 =',R2)
print('--------------------------')

print('P1 =',P1)
print('--------------------------')

print('P2 =',P2)
print('--------------------------')

print('Q =',Q)
print('--------------------------')

R1 = [[ 9.99925156e-01  1.17570135e-02  3.38446467e-03]
 [-1.17576983e-02  9.99930859e-01  1.82515812e-04]
 [-3.38208483e-03 -2.22295666e-04  9.99994256e-01]]
--------------------------
R2 = [[ 9.99951326e-01  3.80597815e-03  9.10276705e-03]
 [-3.80413556e-03  9.99992740e-01 -2.19726491e-04]
 [-9.10353724e-03  1.85087636e-04  9.99958545e-01]]
--------------------------
P1 = [[291.34777269   0.         178.89403582   0.        ]
 [  0.         291.34777269 124.82925034   0.        ]
 [  0.           0.           1.           0.        ]]
--------------------------
P2 = [[2.91347773e+02 0.00000000e+00 1.78894036e+02 1.75468876e+04]
 [0.00000000e+00 2.91347773e+02 1.24829250e+02 0.00000000e+00]
 [0.00000000e+00 0.00000000e+00 1.00000000e+00 0.00000000e+00]]
--------------------------
Q = [[ 1.00000000e+00  0.00000000e+00  0.00000000e+00 -1.78894036e+02]
 [ 0.00000000e+00  1.00000000e+00  0.00000000e+00 -1.24829250e+02]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  2.91347773e+02]
 [ 0.00000000e+00  0.00000000e+00 -1.66039573e-02  0.00000000e+00]]
--------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

stpoint1 = [85,72]
endpoint1 = [160,109]
stpoint2 = [173,80]
endpoint2 = [247,116]

center1 = []
center2 = []

for row in range(stpoint1[0],endpoint1[0]):
    for col in range(stpoint1[1],endpoint1[1]):
        center1.append([row,col])

for row in range(stpoint2[0],endpoint2[0]):
    for col in range(stpoint2[1],endpoint2[1]):
        center2.append([row,col])

if  len(center1)> len(center2):
    min = len(center2)

if len(center1)< len(center2):
    min = len(center1)

depth = sum(depth_dist)/len(depth_dist)
print("Avg Depth = ",depth)

p1 = endpoint1[0]-stpoint1[0]
p2 = endpoint2[0]-stpoint2[0]
d = depth
f1 = 277.5
f2 = 277.7
w1 = (p1*d)/f1
w2 = (p2*d)/f2

print(w1,w2)
```

## Matlap python mapping  with mouse events

- v0
    
    ```python
    import cv2
    import numpy as np
    from scipy import linalg
    
    click_num = 1
    stpoint1 = []
    endpoint = []
    stpoint2 = []
    endpoint2 = []
    
    def calibration_using_matlab_matrices():
        #cameraMatrix1,cameraMatrix2,distCoeffs1,distCoeffs2,R,T are from matlab
    
        cameraMatrix1 =np.array([[277.568209281413,0,175.994911474612],
                                  [0,275.854471050798,126.303097063272],
                                  [0,0,1]])
    
        cameraMatrix2 = np.array([[277.715050885340,0,178.386954557862],
                                   [0,276.046208656089,133.035513725994],
                                   [0,0,1]])
    
        distCoeffs1 = np.array([[0.106470018522182,-0.191653327533418,0,0]])
    
        distCoeffs2 = np.array([[0.0804085091338224,-0.126266161749049,0,0]])
    
        R = np.array([[0.999952002568791,0.00795459232996310,-0.00571987932823699],
                     [-0.00795254560327413,0.999968305623573,0.000380482258625782],
                     [0.00572272462148460,-0.000334976395251666,0.999983568971871]])
    
        T = np.array([[60.2236749452017],
                     [0.229221148029915],
                     [0.548228768631346]])
    
        imageSize = np.array([240,320])
        (R1, R2, P1, P2, Q, leftROI, rightROI) = cv2.stereoRectify(cameraMatrix1, distCoeffs1, cameraMatrix2, distCoeffs2, imageSize, R, T, None, None, None, None, None, cv2.CALIB_ZERO_DISPARITY, 0)
    
        """print('R1 =',R1)
        print('--------------------------')
    
        print('R2 =',R2)
        print('--------------------------')
    
        print('P1 =',P1)
        print('--------------------------')
    
        print('P2 =',P2)
        print('--------------------------')
    
        print('Q =',Q)
        print('--------------------------')"""
    
        return R1, R2, P1, P2, Q
    
    def DLT(P1, P2, point1, point2):
        A = [point1[1] * P1[2, :] - P1[1, :],
             P1[0, :] - point1[0] * P1[2, :],
             point2[1] * P2[2, :] - P2[1, :],
             P2[0, :] - point2[0] * P2[2, :]
             ]
        A = np.array(A).reshape((4, 4))
    
        B = A.transpose() @ A
        U, s, Vh = linalg.svd(B, full_matrices=False)
    
        return (Vh[3, 0:3] / Vh[3, 3])/10
    
    def get_destance():
        global stpoint1, endpoint1, stpoint2, endpoint2
        hole_object_distance = distance(stpoint1, endpoint1, stpoint2, endpoint2)
    
        width = endpoint1[0] - stpoint1[0]
        step = int(width * 0.1)
    
        part_distances = []
        for i in range(1, int(width / step) + 1):
            #print(i, step)
            endpoint1[0] = stpoint1[0] + step
            endpoint2[0] = stpoint2[0] + step
            #print(stpoint1, endpoint1, stpoint2, endpoint2)
            part_distances.append(distance(stpoint1, endpoint1, stpoint2, endpoint2))
            stpoint1[0] = endpoint1[0]
            stpoint2[0] = endpoint2[0]
    
        print("Hole object distance: ",hole_object_distance)
        print("Sum of object partial parts: ",sum(part_distances))
    
    def distance(stpoint1, endpoint1, stpoint2, endpoint2):
        center1 = []
        center2 = []
        for row in range(stpoint1[0],endpoint1[0]):
            for col in range(stpoint1[1],endpoint1[1]):
                center1.append([row,col])
    
        for row in range(stpoint2[0],endpoint2[0]):
            for col in range(stpoint2[1],endpoint2[1]):
                center2.append([row,col])
    
        if  len(center1) > len(center2):
            min = len(center2)
    
        if len(center1) <= len(center2):
            min = len(center1)
    
        depth_dist = []
        for i in range(1,min):
            point3d = DLT(P1, P2, center1[i], center2[i])
            depth_dist.append(point3d[2])
    
        depth = sum(depth_dist)/len(depth_dist)
        print("Avg Depth = ",depth)
    
        p1 = endpoint1[0]-stpoint1[0]
        p2 = endpoint2[0]-stpoint2[0]
        d = depth
        f1 = 277.5
        f2 = 277.7
        w1 = (p1*d)/f1
        w2 = (p2*d)/f2
    
        #print(w1,w2)
        return (w1+w2)/2
    
    # function to display the coordinates of the points clicked on the image
    def click_event1R(event, x, y, flags, params):
        global click_num,stpoint1,endpoint1,stpoint2,endpoint2
        # checking for left mouse clicks
        if event == cv2.EVENT_LBUTTONDOWN:
            # displaying the coordinates on the Shell
            print(x,y)
    
            # displaying the coordinates on the image window
            font = cv2.FONT_HERSHEY_SIMPLEX
            cv2.putText(img1R, '.', (x-6,y), font,1, (0, 255, 0), 2)
            cv2.imshow('image1R', img1R)
    
            if click_num == 1:
                stpoint1 = [x, y]
                click_num = click_num + 1
            elif click_num == 2:
                endpoint1 = [x, y]
                click_num = click_num + 1
    
    def click_event2L(event, x, y, flags, params):
        global click_num, stpoint1, endpoint1, stpoint2, endpoint2
        # checking for left mouse clicks
        if event == cv2.EVENT_LBUTTONDOWN:
            # displaying the coordinates on the Shell
            print(x,y)
    
            # displaying the coordinates on the image window
            font = cv2.FONT_HERSHEY_SIMPLEX
            cv2.putText(img2L, '.', (x-6,y), font,1, (0, 0, 255), 2)
            cv2.imshow('image2L', img2L)
    
            if click_num == 3:
                stpoint2 = [x, y]
                click_num = click_num + 1
            elif click_num == 4:
                endpoint2 = [x, y]
                click_num = click_num + 1
                get_destance()
    
    if __name__=="__main__":
        R1, R2, P1, P2, Q = calibration_using_matlab_matrices()
    
        img1R = cv2.imread('stereoRight/imageR04.png')
        img2L = cv2.imread('stereoLeft/imageL04.png')
    
        cv2.imshow('image1R', img1R)
        cv2.imshow('image2L', img2L)
    
        # setting mouse handler for the image and calling the click_event() function
        cv2.setMouseCallback('image1R', click_event1R)
        cv2.setMouseCallback('image2L', click_event2L)
        cv2.waitKey(0)
        cv2.destroyAllWindows()
    ```
    

v1

```python
import cv2
import numpy as np
from scipy import linalg
import math

click_num = 1
stpoint1 = []
endpoint = []
stpoint2 = []
endpoint2 = []

def calibration_using_matlab_matrices():
    #cameraMatrix1,cameraMatrix2,distCoeffs1,distCoeffs2,R,T are from matlab

    cameraMatrix1 =np.array([[277.568209281413,0,175.994911474612],
                              [0,275.854471050798,126.303097063272],
                              [0,0,1]])

    cameraMatrix2 = np.array([[277.715050885340,0,178.386954557862],
                               [0,276.046208656089,133.035513725994],
                               [0,0,1]])

    distCoeffs1 = np.array([[0.106470018522182,-0.191653327533418,0,0]])

    distCoeffs2 = np.array([[0.0804085091338224,-0.126266161749049,0,0]])

    R = np.array([[0.999952002568791,0.00795459232996310,-0.00571987932823699],
                 [-0.00795254560327413,0.999968305623573,0.000380482258625782],
                 [0.00572272462148460,-0.000334976395251666,0.999983568971871]])

    T = np.array([[60.2236749452017],
                 [0.229221148029915],
                 [0.548228768631346]])

    imageSize = np.array([240,320])
    (R1, R2, P1, P2, Q, leftROI, rightROI) = cv2.stereoRectify(cameraMatrix1, distCoeffs1, cameraMatrix2, distCoeffs2, imageSize, R, T, None, None, None, None, None, cv2.CALIB_ZERO_DISPARITY, 0)

    """print('R1 =',R1)
    print('--------------------------')

    print('R2 =',R2)
    print('--------------------------')

    print('P1 =',P1)
    print('--------------------------')

    print('P2 =',P2)
    print('--------------------------')

    print('Q =',Q)
    print('--------------------------')"""

    return R1, R2, P1, P2, Q

def DLT(P1, P2, point1, point2):
    A = [point1[1] * P1[2, :] - P1[1, :],
         P1[0, :] - point1[0] * P1[2, :],
         point2[1] * P2[2, :] - P2[1, :],
         P2[0, :] - point2[0] * P2[2, :]
         ]
    A = np.array(A).reshape((4, 4))

    B = A.transpose() @ A
    U, s, Vh = linalg.svd(B, full_matrices=False)
    return (Vh[3, 0:3] / Vh[3, 3])/10

def get_length():
    global stpoint1, endpoint1, stpoint2, endpoint2
    p1_3d = DLT(P1, P2, stpoint1, stpoint2)
    p2_3d = DLT(P1, P2, endpoint1, endpoint2)
    #print(p13d)
    #print(p23d)
    print("Length: ", math.sqrt( (p1_3d[0]-p2_3d[0])**2 + (p1_3d[1]-p2_3d[1])**2 + (p1_3d[2]-p2_3d[2])**2) )

    cv2.line(img1R, stpoint1, endpoint1, (200, 30, 30), 2)
    cv2.line(img2L, stpoint2, endpoint2, (255, 30, 30), 2)
    cv2.imshow('image1R', img1R)
    cv2.imshow('image2L', img2L)

# function to display the coordinates of the points clicked on the image
def click_event1R(event, x, y, flags, params):
    global click_num,stpoint1,endpoint1,stpoint2,endpoint2
    # checking for left mouse clicks
    if event == cv2.EVENT_LBUTTONDOWN:
        # displaying the coordinates on the Shell
        print(x,y)

        # displaying the coordinates on the image window
        font = cv2.FONT_HERSHEY_SIMPLEX
        cv2.putText(img1R, '.', (x-6,y), font,1, (0, 255, 0), 2)
        cv2.imshow('image1R', img1R)

        if click_num == 1:
            stpoint1 = [x, y]
            click_num = click_num + 1
        elif click_num == 2:
            endpoint1 = [x, y]
            click_num = click_num + 1

def click_event2L(event, x, y, flags, params):
    global click_num, stpoint1, endpoint1, stpoint2, endpoint2
    # checking for left mouse clicks
    if event == cv2.EVENT_LBUTTONDOWN:
        # displaying the coordinates on the Shell
        print(x,y)

        # displaying the coordinates on the image window
        font = cv2.FONT_HERSHEY_SIMPLEX
        cv2.putText(img2L, '.', (x-6,y), font,1, (0, 0, 255), 2)
        cv2.imshow('image2L', img2L)

        if click_num == 3:
            stpoint2 = [x, y]
            click_num = click_num + 1
        elif click_num == 4:
            endpoint2 = [x, y]
            click_num = click_num + 1
            get_length()

if __name__=="__main__":
    R1, R2, P1, P2, Q = calibration_using_matlab_matrices()

    img1R = cv2.imread('images/test/badR0.png')
    img2L = cv2.imread('images/test/badL0.png')

    cv2.imshow('image1R', img1R)
    cv2.imshow('image2L', img2L)

    # setting mouse handler for the image and calling the click_event() function
    cv2.setMouseCallback('image1R', click_event1R)
    cv2.setMouseCallback('image2L', click_event2L)
    cv2.waitKey(0)
    cv2.destroyAllWindows()
```

Actual length = 22.5

Measured Length = 22.35

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%204.png)

## Enhancements

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%205.png)

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%206.png)

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%207.png)

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%208.png)

![Untitled](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/Untitled%209.png)

- `vl = vr` so we can select the first point and then draw a horizontal line and the corresponding point in the other image will be on that line, only the u is unknown. This will make selecting the corresponding point in the other image easier so more accurate result.

## Underwater Calibration

```matlab
cameraMatrix1 =  stereoParameters.CameraParameters1.IntrinsicMatrix'
18003.9315286048	0	166.935354857670
0	16512.7713953394	113.352350866995
0	0	1

cameraMatrix2 = stereoParameters.CameraParameters2.IntrinsicMatrix'
7657.58844671460	0	5644.94393097267
0	8937.43774110676	10.9348693419898
0	0	1

%no RadialDistortion(3) only 1:2
distCoeffs1 = [stereoParameters.CameraParameters1.RadialDistortion(1:2), stereoParameters.CameraParameters1.TangentialDistortion, stereoParameters.CameraParameters1.RadialDistortion(3)]
[[870.644211801477	-1176471.09586324],[0,0]] 

distCoeffs2 = [stereoParameters.CameraParameters2.RadialDistortion(1:2), stereoParameters.CameraParameters2.TangentialDistortion, stereoParameters.CameraParameters2.RadialDistortion(3)]
[[3.67764839977073	-6.89529087347548],[0,0]]

R = stereoParameters.RotationOfCamera2'
0.900753322459198	0.00821441632267849	-0.434253353980362
-0.00554443667733565	0.999957139187247	0.00741478323271511
0.434295649645086	-0.00427120040911815	0.900760259750850

T = stereoParameters.TranslationOfCamera2'
1850.64506228349
-30.9363197569928
-3716.60125401983

%%%%%%%%%%%%%%%%%%%%%%%%%%%
cameraMatrix1 =np.array([[18003.9315286048,0,166.935354857670],
                          [0,16512.7713953394,113.352350866995],
                          [0,0,1]])

cameraMatrix2 = np.array([[7657.58844671460	,0,5644.94393097267],
                           [0,8937.43774110676,10.9348693419898],
                           [0,0,1]])

#no RadialDistortion(3) only 1:2
distCoeffs1 = [870.644211801477,-1176471.09586324,0,0] 

distCoeffs2 = [3.67764839977073,-6.89529087347548,0,0]

R = np.array([[0.900753322459198,0.00821441632267849,-0.434253353980362],
             [-0.00554443667733565,0.999957139187247,0.00741478323271511],
             [0.434295649645086,-0.00427120040911815,0.900760259750850]])

T =np.array([[1850.64506228349],
             [-30.9363197569928],
             [-3716.60125401983]])

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

import cv2
import numpy as np

cameraMatrix1 =np.array([[277.568209281413,0,175.994911474612],
                          [0,275.854471050798,126.303097063272],
                          [0,0,1]])

cameraMatrix2 = np.array([[277.715050885340,0,178.386954557862],
                           [0,276.046208656089,133.035513725994],
                           [0,0,1]])

#no RadialDistortion(3) only 1:2
distCoeffs1 = np.array([[0.106470018522182,-0.191653327533418,0,0]])

distCoeffs2 = np.array([[0.0804085091338224,-0.126266161749049,0,0]])

R = np.array([[0.999952002568791,0.00795459232996310,-0.00571987932823699],
             [-0.00795254560327413,0.999968305623573,0.000380482258625782],
             [0.00572272462148460,-0.000334976395251666,0.999983568971871]])

T =np.array([[60.2236749452017],
             [0.229221148029915],
             [0.548228768631346]])

imageSize = np.array([240,320])
(R1, R2, P1, P2, Q, leftROI, rightROI) = cv2.stereoRectify(cameraMatrix1, distCoeffs1, cameraMatrix2, distCoeffs2, imageSize, R, T, None, None, None, None, None, cv2.CALIB_ZERO_DISPARITY, 0)
print('R1 =',R1)
print('--------------------------')

print('R2 =',R2)
print('--------------------------')

print('P1 =',P1)
print('--------------------------')

print('P2 =',P2)
print('--------------------------')

print('Q =',Q)
print('--------------------------')

R1 = [[ 9.99925156e-01  1.17570135e-02  3.38446467e-03]
 [-1.17576983e-02  9.99930859e-01  1.82515812e-04]
 [-3.38208483e-03 -2.22295666e-04  9.99994256e-01]]
--------------------------
R2 = [[ 9.99951326e-01  3.80597815e-03  9.10276705e-03]
 [-3.80413556e-03  9.99992740e-01 -2.19726491e-04]
 [-9.10353724e-03  1.85087636e-04  9.99958545e-01]]
--------------------------
P1 = [[291.34777269   0.         178.89403582   0.        ]
 [  0.         291.34777269 124.82925034   0.        ]
 [  0.           0.           1.           0.        ]]
--------------------------
P2 = [[2.91347773e+02 0.00000000e+00 1.78894036e+02 1.75468876e+04]
 [0.00000000e+00 2.91347773e+02 1.24829250e+02 0.00000000e+00]
 [0.00000000e+00 0.00000000e+00 1.00000000e+00 0.00000000e+00]]
--------------------------
Q = [[ 1.00000000e+00  0.00000000e+00  0.00000000e+00 -1.78894036e+02]
 [ 0.00000000e+00  1.00000000e+00  0.00000000e+00 -1.24829250e+02]
 [ 0.00000000e+00  0.00000000e+00  0.00000000e+00  2.91347773e+02]
 [ 0.00000000e+00  0.00000000e+00 -1.66039573e-02  0.00000000e+00]]
--------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

stpoint1 = [85,72]
endpoint1 = [160,109]
stpoint2 = [173,80]
endpoint2 = [247,116]

center1 = []
center2 = []

for row in range(stpoint1[0],endpoint1[0]):
    for col in range(stpoint1[1],endpoint1[1]):
        center1.append([row,col])

for row in range(stpoint2[0],endpoint2[0]):
    for col in range(stpoint2[1],endpoint2[1]):
        center2.append([row,col])

if  len(center1)> len(center2):
    min = len(center2)

if len(center1)< len(center2):
    min = len(center1)

depth_dist = []
for i in range(1,min):
    point3d = DLT(P1, P2, center1[i], center2[i])
    depth_dist.append(point3d[2])

#p3d = DLT(P1, P2, point1, point2)
print(depth_dist)

depth = sum(depth_dist)/len(depth_dist)
print("Avg Depth = ",depth)

p1 = endpoint1[0]-stpoint1[0]
p2 = endpoint2[0]-stpoint2[0]
d = depth
f1 = 277.5
f2 = 277.7
w1 = (p1*d)/f1
w2 = (p2*d)/f2

print(w1,w2)
```

[clibration_images.zip](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/clibration_images.zip)

[m.zip](Assets/Stereo%20c105c50f337c47fab74338f8ea94de41/m.zip)

---

---

## Matlab integration with python

- Install python3. 6 for matlab2016

`sudo add-apt-repository ppa:deadsnakes/ppa`

`sudo apt-get updatesudo apt-get install python3.6`

`apt-get update`

`apt-get install python3-virtualenv`

https://dfordatascience.wordpress.com/2021/04/22/how-to-create-python-3-6-virtual-environment-on-ubuntu-20-04/

---

---

- setup matlab engine

`Cd matlab/extern/engines/python/`

`Sudo python3.6 [setup.py](http://setup.py) install`

- install opencv in python in python3.6

`python -m pip install opencv-python`

`python3.6 -m pip install opencv-python==4.2.0.32`

- numpy error

`python3.6 -m pip install numpy -I`

- error in matlab with the engine

`cd matlab/bin/glnxa64/`

`mkdir exclude`

`mv libfreetype* exclude/`

`cd matalb/sys/os/glnxa64/`

`mkdir exclude`

`mv libstdc++.so.6* exclude/`

https://towardsdatascience.com/matlab-function-in-python-739c473c8176